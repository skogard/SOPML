<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8">
<title>SOPML</title>
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="SOPML" />
<meta name="twitter:description" content="Export Substack subscriptions to OPML" />
<meta name="twitter:image" content="https://skogard.github.io/SOPML/sopml.png" />
<meta property="og:url" content="https://skogard.github.io/SOPML/" />
<meta property="og:type"   content="website" />
<meta property="og:title" content="SOPML" />
<meta property="og:description" content="Export Substack subscriptions to OPML" />
<meta property="og:image" content="https://skogard.github.io/SOPML/sopml.png" />
<style>
body {
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: sans-serif;
}
a.button {
  background: royalblue;
  color: white;
  display: inline-block;
  padding: 10px;
  border-radius: 4px;
  text-decoration: none;
  margin: 20px 0;
  font-size: 14px;
}
a {
  color: royalblue;
}
.container {
  color: gray;
  font-size: 14px;
  max-width: 800px;
}
.step {
  border-bottom: 1px solid rgba(0,0,0,0.1);
  margin-bottom: 20px;
}
.step img {
  width: 100%;
  margin: 20px 0;
}
h1 {
  color: black;
}
</style>
</head>
<body>
<div class='container'>
<div class='step'>
<h1>SOPML</h1>
<div>Substack to OPML</div>
<br><br>
</div>
<div class='step'>
<div>Step 1. Drag below button to your browser bookmarks bar</div>
<a class="button" href="javascript: (async function() {%0A    let resp = await fetch(`%24{window.location.origin}/api/v1/settings`);%0A    let settings = await resp.json();%0A    const escapeHtml = (unsafe) => {%0A        return unsafe.replaceAll('%26', '%26amp;').replaceAll('<', '%26lt;').replaceAll('>', '%26gt;').replaceAll('"', '%26quot;').replaceAll("'", '%26%23039;');%0A    }%0A    let outlines = Array.prototype.map.call(settings['subscriptions'], function(sub) {%0A        let pub = sub['publication'];%0A        return `<outline xmlUrl='%24{escapeHtml(pub["base_url"])}/feed' htmlUrl='%24{escapeHtml(pub["base_url"])}' text='%24{escapeHtml(pub["name"])}'/>`%0A    }).join('%5Cn');%0A    let opml = `<opml version='2.0'>%5Cn<body>%5Cn<outline text='Substack Subscriptions' title='Substack Subscriptions'>%5Cn%24{outlines}%5Cn</outline>%5Cn</body>%5Cn</opml>`;%0A    var data = new Blob([opml], {%0A        type: 'application/xml'%0A    });%0A    var url = window.URL.createObjectURL(data);%0A    let a = document.createElement('a');%0A    a.textContent = 'RSS COLLECTION DOWNLOADING';%0A    a.href = url;%0A    a.download = 'opml.xml';%0A    a.setAttribute('style', 'color: white; background: royalblue; font-size: 14px; padding: 10px 20px; border-radius: 30px; text-decoration: none;');%0A    let popup = document.createElement('div');%0A    popup.setAttribute('style', 'top:0; padding: 20px; text-align: center; font-family: sans-serif; font-size: 16px;');%0A    popup.appendChild(a);%0A    document.body.insertBefore(popup, document.body.firstChild); a.click(); a.textContent = 'RSS COLLECTION DOWNLOADED';%0A})();%0A">Substack OPML</a>
</div>
<div class='step'>
  <div>Step 2. Go to <a target="_blank" href="https://reader.substack.com/inbox">Substack Reader</a>, click the bookmarklet, and download the OPML file</div>
  <img src="bookmarklet.gif">
</div>
</body>
</html>
